<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>File: README</title>
<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html" title="Index">Index</a> &raquo; 
    <span class="title">File: README</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><div id='filecontents'><h2>Hudson <span class="caps">ERB</span> plugin</h2>
<p>Actually this is a Maven plugin to use to develop Hudson&#8217;s plugins and allows to write views with Ruby and <span class="caps">ERB</span> templates.</p>
<p>When we build a Hudson&#8217;s plugin with Maven it generates the jelly files that Hudson needs from our <span class="caps">ERB</span> templates.</p>
<p><em><span class="caps">WARNING</span></em>: Right now it just includes a subset of the form views.</p>
<h3>Configuration</h3>
<p>Add this to the pom file:</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='build identifier id'>build</span><span class='gt op'>&gt;</span>
  <span class='dot3 op'>...</span>
    <span class='lt op'>&lt;</span><span class='plugin identifier id'>plugin</span><span class='gt op'>&gt;</span>
        <span class='lt op'>&lt;</span><span class='groupId identifier id'>groupId</span><span class='gt op'>&gt;</span><span class='org identifier id'>org</span><span class='dot token'>.</span><span class='mirah identifier id'>mirah</span><span class='dot token'>.</span><span class='hudson identifier id'>hudson</span><span class='lt op'>&lt;</span><span class='regexp val'>/groupId&gt;
        &lt;artifactId&gt;hudson-erb-plugin&lt;/</span><span class='artifactId identifier id'>artifactId</span><span class='gt op'>&gt;</span>
        <span class='lt op'>&lt;</span><span class='executions identifier id'>executions</span><span class='gt op'>&gt;</span>
          <span class='lt op'>&lt;</span><span class='execution identifier id'>execution</span><span class='gt op'>&gt;</span>
            <span class='lt op'>&lt;</span><span class='goals identifier id'>goals</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='goal identifier id'>goal</span><span class='gt op'>&gt;</span><span class='erb identifier id'>erb</span><span class='minus op'>-</span><span class='compile identifier id'>compile</span><span class='lt op'>&lt;</span><span class='regexp val'>/goal&gt;&lt;/</span><span class='goals identifier id'>goals</span><span class='gt op'>&gt;</span>
          <span class='lt op'>&lt;</span><span class='regexp val'>/execution&gt;
        &lt;/e</span><span class='xecutions identifier id'>xecutions</span><span class='gt op'>&gt;</span>
      <span class='lt op'>&lt;</span><span class='regexp val'>/plugin&gt;
</span></pre>
<h3>Usage</h3>
<p>Add your <span class="caps">ERB</span> templates in the same place that you added your jelly files
with the same name but with extension <code>jelly.erb</code>, for instance if we have a
configuration form in <code>src/main/resources/hudson/plugin/foo/config.jelly</code> we
have to replace it with
<code>src/main/resources/hudson/plugin/foo/config.jelly.erb</code>.</p>
<h3>Example</h3>
<p>We can replace this code:</p>
<pre class="code">
<span class='lt op'>&lt;</span><span class='j identifier id'>j</span><span class='symbol val'>:jelly</span> <span class='xmlns identifier id'>xmlns</span><span class='symbol val'>:j=</span><span class='string val'>&quot;jelly:core&quot;</span> <span class='xmlns identifier id'>xmlns</span><span class='symbol val'>:st=</span><span class='string val'>&quot;jelly:stapler&quot;</span> <span class='xmlns identifier id'>xmlns</span><span class='symbol val'>:d=</span><span class='string val'>&quot;jelly:define&quot;</span> <span class='xmlns identifier id'>xmlns</span><span class='symbol val'>:l=</span><span class='string val'>&quot;/lib/layout&quot;</span>
         <span class='xmlns identifier id'>xmlns</span><span class='symbol val'>:t=</span><span class='string val'>&quot;/lib/hudson&quot;</span> <span class='xmlns identifier id'>xmlns</span><span class='symbol val'>:f=</span><span class='string val'>&quot;/lib/form&quot;</span> <span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='f identifier id'>f</span><span class='symbol val'>:entry</span> <span class='name identifier id'>name</span><span class='assign token'>=</span><span class='string val'>&quot;Verbose&quot;</span> <span class='description identifier id'>description</span><span class='assign token'>=</span><span class='string val'>&quot;Show Mirah AST generation&quot;</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='f identifier id'>f</span><span class='symbol val'>:checkbox</span> <span class='name identifier id'>name</span><span class='assign token'>=</span><span class='string val'>&quot;verbose&quot;</span> <span class='checked identifier id'>checked</span><span class='assign token'>=</span><span class='string val'>&quot;${instance.verbose}&quot;</span><span class='div op'>/</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='regexp val'>/f:entry&gt;

  &lt;f:entry name=&quot;Script&quot; description=&quot;Mirah script&quot;&gt;
    &lt;f:textarea name=&quot;command&quot; value=&quot;${instance.command}&quot;/</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='regexp val'>/f:entry&gt;
&lt;/</span><span class='j identifier id'>j</span><span class='symbol val'>:jelly</span><span class='gt op'>&gt;</span>
</pre>
<p>with this one:</p>
<pre class="code">
<span class='lt op'>&lt;</span><span class='string val'>% view </span><span class='do do kw'>do</span> <span class='string val'>%&gt;
  &lt;% entry 'Verbose', :description =&gt;</span> <span class='string val'>'Show Mirah AST generation'</span> <span class='do do kw'>do</span> <span class='string val'>%&gt;
    &lt;%= checkbox 'verbose' %&gt;</span>
  <span class='lt op'>&lt;</span><span class='string val'>% end </span><span class='mod op'>%</span><span class='gt op'>&gt;</span>

  <span class='lt op'>&lt;</span><span class='string val'>% entry </span><span class='string val'>'Script'</span><span class='comma token'>,</span> <span class='symbol val'>:description</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Mirah script'</span> <span class='do do kw'>do</span> <span class='string val'>%&gt;
    &lt;%= textarea 'command' %&gt;</span>
  <span class='lt op'>&lt;</span><span class='string val'>% end </span><span class='mod op'>%</span><span class='gt op'>&gt;</span>
<span class='lt op'>&lt;</span><span class='string val'>% end </span><span class='mod op'>%</span><span class='gt op'>&gt;</span>
</pre>
<p>We can see this same example working in the <a href="https://github.com/calavera/mirah.hpi/blob/master/src/main/resources/hudson/plugins/mirah/MirahInterpreter/config.jelly.erb">Mirah Interpreter plugin</a></p>
<h3>Extensions</h3>
<p>In some cases perhaps we want to extend the dsl with our custom tags. We just need to create a file called <code>ext.rb</code> under the directory
<code>src/main/resources/hudson_erb</code> into our plugin and add the custom code to the module <code>Hudson::View</code>:</p>
<pre class="code">
<span class='module module kw'>module</span> <span class='Hudson constant id'>Hudson</span>
  <span class='module module kw'>module</span> <span class='View constant id'>View</span>
    <span class='def def kw'>def</span> <span class='foo identifier id'>foo</span>
      <span class='string val'>'&lt;input type=&quot;foo&quot;/&gt;'</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
<p>Then we can use that method in our views as we used any other:</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='string val'>% entry </span><span class='string val'>'Foo'</span><span class='comma token'>,</span> <span class='symbol val'>:description</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'My foo input'</span> <span class='do do kw'>do</span> <span class='string val'>%&gt;
    &lt;%= foo %&gt;</span>
  <span class='lt op'>&lt;</span><span class='string val'>% end </span><span class='mod op'>%</span><span class='gt op'>&gt;</span>
</pre></div></div>
    
    <div id="footer">
  Generated on Fri Dec 10 19:13:59 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.3 (ruby-1.8.7).
</div>

  </body>
</html>